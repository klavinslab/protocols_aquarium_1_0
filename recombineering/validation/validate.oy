base_dir = "recombineering/validation/"
cloning_base = "cloning/workflow/"

argument
  overnights: sample("E coli strain") array, "overnights to test"
  f_pri: sample("Primer") array, "forward assay primer"
  r_pri: sample("Primer") array, "reverse assay primer"
  enzyme_id: sample("Enzyme"), "Physion HF MM"
end

place parse_args
  marked: true
end

place boil_cells
	protocol: base_dir+"boil_cells.pl"	
  argument
    overnights: overnights
  end
	start: now()
	window: days(1)
	group: "technicians"
end

place pcr
  protocol: cloning_base + "010_PCR.pl"
  argument
    initials: "REC"
    enzyme_id: enzyme_id
    tanneal: 65
    forward_ids: f_pri
    reverse_ids: r_pri
  end
  start: now()
  window: days(1)
  group: "technicians"
end
wire (boil_cells, "gen_preps") => (pcr,"template_ids")
wire (boil_cells, "frag_names") => (pcr,"fragment_names")


# forward transitions
transition [parse_args] => [boil_cells] when true end
transition [boil_cells] => [pcr] when !error(0) && completed(0) end
transition [pcr] => [] when !error(0) && completed(0) end


# remaining reverse transitions
transition [boil_cells] => [boil_cells] when error(0) end 
transition [pcr] => [pcr] when error(0) end 


